<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Insight Visibility Governance Matrix</title>
<style>
:root {
    --chinese-red:#8B0000;
    --chinese-gold:#FFD700;
    --paper-beige:#F5F5DC;
    --light-cream:#FFFEF0;
    --ink-black:#1a1a1a;
    --level-1:#8B0000;
    --level-2:#CD5C5C;
    --level-3:#666;
    --level-4:#999;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{
    background:linear-gradient(135deg,var(--paper-beige)0%,var(--light-cream)100%);
    color:var(--ink-black);
    margin:0;
    padding:0;
    width:100vw;
    max-width:100%;
    line-height:1.2;
    font-size:14px;
    font-family:-apple-system,BlinkMacSystemFont,'SF Pro','Segoe UI',Roboto,Arial,sans-serif;
}
.container{width:100%;padding:0;margin:0;}
header{padding:6px 8px 0 8px;}
h1{
    font-size:26px;font-weight:900;margin:4px 0;padding:6px 4px;
    background:linear-gradient(135deg,var(--chinese-red),#CD5C5C);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    letter-spacing:-0.4px;
}
button{
    background:linear-gradient(135deg,var(--chinese-red),#CD5C5C);
    color:#fff;border:1px solid rgba(255,215,0,0.35);
    padding:4px 10px;margin:0 2px;font-size:12px;border-radius:2px;cursor:pointer;font-weight:600;
}
button:hover{transform:translateY(-1px);box-shadow:0 1px 4px rgba(139,0,0,0.28);}
.controls{text-align:right;margin:0 6px 4px 0;}
.important-always-visible{background:linear-gradient(135deg,rgba(255,215,0,0.22),white);border:2px solid var(--chinese-gold);padding:8px;margin:4px;box-shadow:0 1px 4px rgba(139,0,0,0.18);}
.two-column-layout{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;padding:4px;}
.full-width{grid-column:1 / -1;}
.dense-list{list-style:none;padding:0;margin:0;}
.dense-list li{padding:2px 0 2px 14px;border-left:2px solid transparent;position:relative;line-height:1.2;}
.dense-list li:before{content:"‚ñ∏";position:absolute;left:0;font-size:10px;color:var(--chinese-red);}
.dense-list li strong{color:var(--level-2);font-weight:600;}
.collapsible{border:1px solid rgba(139,0,0,0.14);background:white;}
.collapsible-header{cursor:pointer;padding:6px 10px;background:linear-gradient(135deg,rgba(139,0,0,0.08),rgba(255,215,0,0.05));border-left:3px solid var(--chinese-gold);display:flex;justify-content:space-between;align-items:center;font-weight:600;font-size:13px;color:var(--level-2);}
.collapsible-header .arrow{transition:transform 0.3s ease;font-size:11px;color:var(--chinese-red);}
.collapsible.open .collapsible-header .arrow{transform:rotate(90deg);}
.collapsible-content{max-height:0;overflow:hidden;transition:max-height 0.3s ease;padding:0 10px;}
.collapsible.open .collapsible-content{max-height:2600px;padding:6px 10px 8px 10px;}
.badge{display:inline-block;padding:1px 6px;border-radius:999px;font-size:10px;font-weight:600;background:rgba(139,0,0,0.12);color:var(--level-1);margin-left:4px;}
table{width:100%;border-collapse:collapse;font-size:12px;margin:4px 0;background:white;}
th,td{border:1px solid rgba(139,0,0,0.15);padding:4px 6px;text-align:left;vertical-align:top;}
th{background:rgba(139,0,0,0.08);color:var(--level-1);font-weight:700;}
.status-chip{display:inline-block;padding:2px 8px;border-radius:999px;font-size:11px;font-weight:600;margin-right:4px;}
.status-chip.learners{background:rgba(0,168,107,0.18);color:#006644;border:1px solid rgba(0,168,107,0.3);}
.status-chip.facilitators{background:rgba(255,215,0,0.2);color:var(--level-1);border:1px solid rgba(205,92,92,0.25);}
.status-chip.admins{background:rgba(0,0,0,0.07);color:var(--level-3);border:1px solid rgba(0,0,0,0.12);}
.code-block{font-family:'SF Mono','Menlo','Consolas',monospace;background:rgba(0,0,0,0.06);padding:8px;border-radius:4px;font-size:11px;line-height:1.35;white-space:pre-wrap;word-break:break-word;}
</style>
</head>
<body>
<div class="container">
<header>
<h1>Insight Visibility Governance Matrix</h1>
<div class="controls"><button id="expand-all">Expand All</button><button id="collapse-all">Collapse All</button></div>
</header>
<section class="important-always-visible">
<h2>üéØ Immediate Guardrails</h2>
<div class="two-column-layout">
<ul class="dense-list">
<li><strong>Default learner view:</strong> Surface text, translations, and prompt inspector are open; insights stay hidden unless facilitator toggles access.</li>
<li><strong>Audit parity:</strong> Agent Lens mirrors the exact `context_snapshot` payload so any exposed insight must already exist in the moderator log.</li>
</ul>
<ul class="dense-list">
<li><strong>Toggle authority:</strong> Only facilitators and admins can reveal insight streams; every reveal writes an immutable entry to the event feed.</li>
<li><strong>Fall-back:</strong> If governance service fails, the UI hard-locks insight panes closed and surfaces a warning badge.</li>
</ul>
</div>
</section>
<main class="two-column-layout">
<div class="collapsible" data-collapsible="open">
<div class="collapsible-header"><span>üèõÔ∏è Role Permissions</span><span class="arrow">‚ñ∂</span></div>
<div class="collapsible-content">
<table>
<tr><th>Role</th><th>Insight Access</th><th>Prompt Inspector</th><th>Agent Lens</th><th>Audit Duties</th></tr>
<tr><td><span class="status-chip learners">Learner</span></td><td>Read-only hidden by default; cannot unmask.</td><td>Full read-only view; download disabled.</td><td>Read-only; sees same surfaces as agents.</td><td>Report discrepancies via UI flag.</td></tr>
<tr><td><span class="status-chip facilitators">Facilitator</span></td><td>May temporarily unmask for coaching; auto re-hide after session step.</td><td>Full view with download; must note rationale when exporting.</td><td>Read/write notes; validates context alignment.</td><td>Files governance note per reveal.</td></tr>
<tr><td><span class="status-chip admins">Admin</span></td><td>Persistent access; can override locks for incident review.</td><td>Full access, including JSON payload export.</td><td>Manage retention policies and purge schedule.</td><td>Maintain immutable audit log.</td></tr>
</table>
</div>
</div>
<div class="collapsible" data-collapsible="open">
<div class="collapsible-header"><span>‚öôÔ∏è Toggle Workflow</span><span class="arrow">‚ñ∂</span></div>
<div class="collapsible-content">
<ul class="dense-list">
<li><strong>Step 1:</strong> Facilitator requests reveal; modal displays context snapshot ID (e.g., `ctx-5`).</li>
<li><strong>Step 2:</strong> Governance microservice validates requester role and session status, returning signed token.</li>
<li><strong>Step 3:</strong> UI flips the Insight pane, stamps event feed with `{user: facilitator, action: reveal, snapshot: ctx-5}`.</li>
<li><strong>Step 4:</strong> After 10 minutes or manual hide, panel auto-closes and emits a `conceal` entry.</li>
</ul>
<div class="code-block">POST /governance/insight-toggle
{
  "snapshotId": "ctx-5",
  "actor": "facilitator",
  "action": "reveal",
  "expiresAt": "2025-10-06T15:20:00-04:00"
}</div>
</div>
</div>
<div class="collapsible" data-collapsible="closed">
<div class="collapsible-header"><span>üìä Compliance Checklist</span><span class="arrow">‚ñ∂</span></div>
<div class="collapsible-content">
<ul class="dense-list">
<li><strong>Signed logging:</strong> Context snapshots and prompt downloads hash to the same ledger entry.</li>
<li><strong>Retention tiers:</strong> Insight payloads persist 90 days (facilitator scope) vs. 12 months (admin scope).</li>
<li><strong>Redaction:</strong> If learner transcripts are exported, insights are removed unless facilitator and admin sign-off both exist.</li>
<li><strong>Incident mode:</strong> Admin override triggers UI banner ‚ÄúInsight unlock under review,‚Äù locking learner screen share.</li>
</ul>
</div>
</div>
<div class="collapsible full-width" data-collapsible="closed">
<div class="collapsible-header"><span>üß≠ Alignment With Prompt Inspector</span><span class="arrow">‚ñ∂</span></div>
<div class="collapsible-content">
<ul class="dense-list">
<li><strong>Prompt downloads:</strong> Facilitators and admins can export prompts; learners only view rendered text inline.</li>
<li><strong>Context parity:</strong> When insights are hidden, the Agent Lens still lists every message ID used to assemble the prompt, proving nothing was removed.</li>
<li><strong>Live reveals:</strong> Any live prompt composed during a session inherits the highest currently visible insight scope.</li>
</ul>
</div>
</div>
</main>
</div>
<script>
document.addEventListener('DOMContentLoaded',function(){
    document.querySelectorAll('[data-collapsible]').forEach(function(section){
        const isOpen = section.getAttribute('data-collapsible') === 'open';
        section.classList.add('collapsible');
        if(isOpen) section.classList.add('open');
    });
    document.querySelectorAll('.collapsible-header').forEach(function(header){
        header.addEventListener('click',function(){
            const collapsible=this.closest('.collapsible');
            collapsible.classList.toggle('open');
        });
    });
    const expandAllBtn=document.getElementById('expand-all');
    const collapseAllBtn=document.getElementById('collapse-all');
    if(expandAllBtn){
        expandAllBtn.addEventListener('click',function(){
            document.querySelectorAll('.collapsible').forEach(function(c){c.classList.add('open');});
        });
    }
    if(collapseAllBtn){
        collapseAllBtn.addEventListener('click',function(){
            document.querySelectorAll('.collapsible').forEach(function(c){c.classList.remove('open');});
        });
    }
});
</script>
</body>
</html>
