<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Agent Context Visibility & Prompt Transparency</title>
<style>
:root {
    --chinese-red:#8B0000;
    --chinese-gold:#FFD700;
    --paper-beige:#F5F5DC;
    --light-cream:#FFFEF0;
    --ink-black:#1a1a1a;
    --level-1:#8B0000;
    --level-2:#CD5C5C;
    --level-3:#666;
    --level-4:#999;
    --critical:#B22222;
    --warning:#FF8C00;
    --normal:#1a1a1a;
    --muted:#777;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{
    background:linear-gradient(135deg,var(--paper-beige)0%,var(--light-cream)100%);
    color:var(--ink-black);
    margin:0;
    padding:0;
    width:100vw;
    max-width:100%;
    line-height:1.2;
    font-size:14px;
    font-family:-apple-system,BlinkMacSystemFont,'SF Pro','Segoe UI',Roboto,Arial,sans-serif;
}
.container{width:100%;padding:0;margin:0;}
header{padding:6px 8px 0 8px;}
h1{font-size:26px;font-weight:900;margin:4px 0;padding:6px 4px;background:linear-gradient(135deg,var(--chinese-red),#CD5C5C);-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:-0.4px;}
button{background:linear-gradient(135deg,var(--chinese-red),#CD5C5C);color:#fff;border:1px solid rgba(255,215,0,0.35);padding:4px 10px;margin:0 2px;font-size:12px;border-radius:2px;cursor:pointer;font-weight:600;transition:all .2s ease;}
button:hover{transform:translateY(-1px);box-shadow:0 1px 4px rgba(139,0,0,0.28);}
.controls{margin:0 4px 6px 4px;text-align:right;}
.important-always-visible{background:linear-gradient(135deg,rgba(255,215,0,0.2),white);border:2px solid var(--chinese-gold);padding:8px;margin:4px;box-shadow:0 1px 4px rgba(139,0,0,0.18);}
.two-column-layout{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;padding:4px;}
.full-width{grid-column:1 / -1;}
.dense-list{list-style:none;padding:0;margin:0;}
.dense-list li{padding:2px 0 2px 14px;border-left:2px solid transparent;position:relative;line-height:1.2;}
.dense-list li:before{content:"‚ñ∏";position:absolute;left:0;font-size:10px;color:var(--chinese-red);} 
.dense-list li strong{color:var(--level-2);font-weight:600;}
.badge{display:inline-block;padding:1px 6px;border-radius:999px;font-size:10px;font-weight:600;background:rgba(139,0,0,0.12);color:var(--level-1);margin-left:4px;}
.key-value{display:grid;grid-template-columns:112px 1fr;gap:2px 8px;padding:4px 0;}
.key-value span{font-size:12px;line-height:1.2;}
.key{color:var(--level-2);font-weight:600;text-transform:uppercase;letter-spacing:0.4px;}
.value{color:var(--normal);}
.collapsible{border:1px solid rgba(139,0,0,0.14);background:white;}
.collapsible-header{cursor:pointer;padding:6px 10px;background:linear-gradient(135deg,rgba(139,0,0,0.08),rgba(255,215,0,0.05));border-left:3px solid var(--chinese-gold);display:flex;justify-content:space-between;align-items:center;font-weight:600;font-size:13px;color:var(--level-2);}
.collapsible-header .arrow{transition:transform 0.3s ease;font-size:11px;color:var(--chinese-red);}
.collapsible.open .collapsible-header .arrow{transform:rotate(90deg);}
.collapsible-content{max-height:0;overflow:hidden;transition:max-height 0.3s ease;padding:0 10px;}
.collapsible.open .collapsible-content{max-height:2600px;padding:6px 10px 8px 10px;}
.tag{display:inline-block;background:rgba(255,215,0,0.18);border:1px solid rgba(139,0,0,0.2);border-radius:999px;padding:1px 6px;font-size:10px;margin:0 4px 2px 0;color:var(--level-2);}
.status{font-weight:700;}
.status.critical{color:var(--critical);}
.status.warning{color:var(--warning);}
.status.normal{color:var(--normal);}
.status.muted{color:var(--muted);}
section p{font-size:12px;margin:2px 0 6px 0;color:var(--normal);}
code{font-family:'SF Mono','Menlo','Consolas',monospace;font-size:11px;background:rgba(0,0,0,0.05);padding:1px 4px;border-radius:2px;}
table{width:100%;border-collapse:collapse;font-size:12px;margin:4px 0;background:white;}
th,td{border:1px solid rgba(139,0,0,0.15);padding:4px 6px;text-align:left;vertical-align:top;}
th{background:rgba(139,0,0,0.08);color:var(--level-1);font-weight:700;}
small{color:var(--muted);font-size:11px;}
</style>
</head>
<body>
<div class="container">
<header>
<h1>Agent Context Visibility & Prompt Transparency</h1>
<div class="controls"><button id="expand-all">Expand All</button><button id="collapse-all">Collapse All</button></div>
</header>
<section class="important-always-visible">
<h2>üéØ Immediate Guidance</h2>
<div class="two-column-layout">
<ul class="dense-list">
<li><strong>Context Scope:</strong> Treat every addressed message plus the agent's own outputs as the minimum replay buffer; retain ordered history per <code>contextId</code> as shown in <em>confucian_philosophers_a2a_architecture.html</em>.</li>
<li><strong>User Inspectability:</strong> Mirror that buffer in the UI via an "Agent Lens" pane so learners see identical tokens, not summaries.</li>
</ul>
<ul class="dense-list">
<li><strong>Prompt Transparency:</strong> Expose both the reusable XML template (see <em>prompt_template_details.html</em>) and the instantiated prompt string generated for this turn.</li>
<li><strong>Demo Focus:</strong> Log the literal payload sent this message (surface, insight, metadata) so observers verify nothing is hidden.</li>
</ul>
</div>
</section>
<main class="two-column-layout">
<div class="collapsible" data-collapsible="open">
<div class="collapsible-header"><span>üìç Context Layers & Retention Rules</span><span class="arrow">‚ñ∂</span></div>
<div class="collapsible-content">
<div class="key-value"><span class="key">Layer</span><span class="value"><span class="tag">Conversation</span><span class="tag">Agent</span></span></div>
<div class="key-value"><span class="key">What to Keep</span><span class="value">All user prompts routed to the agent, moderator directives, and every <code>surface</code>/<code>insight</code> pair the agent returned; store as ordered JSON objects.</span></div>
<div class="key-value"><span class="key">Rationale</span><span class="value">Maintains philosophical coherence and enables cross-round critique without hallucination, per the phase loops documented in <em>confucian_cafe_three_phase_integration.html</em>.</span></div>
<div class="key-value"><span class="key">Expiry</span><span class="value">Archive but never discard within an active demo session; rotate to cold storage after session ends so future replays can be reconstructed.</span></div>
<table>
<tr><th>Layer</th><th>Contents</th><th>Access</th><th>Implementation Cue</th></tr>
<tr><td>Session</td><td>Router decisions, round metadata, topic framing</td><td>Moderator + auditors</td><td>Persist <code>contextId</code> bundle exactly as in <code>ConversationStore</code> class (see architecture doc).</td></tr>
<tr><td>Agent</td><td>Addressed prompts + agent responses</td><td>Agent, moderator, UI inspector</td><td>Expose via <code>metadata.context</code> array when invoking subsequent philosophers.</td></tr>
<tr><td>Global</td><td>Persona canon, guardrails, evaluation rubrics</td><td>All agents read-only</td><td>Reuse the persona cards outlined in <em>confucian_cafe_complete_architecture.html</em>.</td></tr>
</table>
<p><span class="status warning">Reminder:</span> Any private tool outputs (retrieval notes, scoring) should be labelled and optionally redacted for learners, but still viewable by facilitators.</p>
</div>
</div>
<div class="collapsible" data-collapsible="open">
<div class="collapsible-header"><span>üèõÔ∏è Existing Assets in Directory</span><span class="arrow">‚ñ∂</span></div>
<div class="collapsible-content">
<ul class="dense-list">
<li><strong>Architectural Backbone:</strong> <em>confucian_philosophers_a2a_architecture.html</em> already sketches JSON-RPC handlers with <code>context</code> ingestion‚Äîextend its <code>ConversationStore</code> to emit inspection snapshots.</li>
<li><strong>Prompt Canon:</strong> <em>prompt_template_details.html</em> and <em>prompt_template_revision.html</em> define the XML scaffold and <code>&lt;PeerStatements&gt;</code> block that carries prior surfaces.</li>
<li><strong>Flow Visuals:</strong> <em>agui_event_flow.html</em> and <em>mermaid</em> variant map SSE events; add a lane for "Context Inspector" publishing the same payloads.</li>
<li><strong>UI Concepts:</strong> <em>confucian_cafe_ui_react_demo.html</em> shows insight/surface split; bolt on a read-only viewer that prints the exact prompt string next to the rendered chips.</li>
<li><strong>Multilingual Mode:</strong> <em>confucian_cafe_multilingual_autonomy.html</em> covers translation toggles‚Äîensure inspector displays both original prompt and localized variant.</li>
</ul>
<p><span class="status normal">Use these files</span> as canonical references when wiring storage, ensuring all new inspector panels inherit typography and collapsible patterns for continuity.</p>
</div>
</div>
<div class="collapsible full-width" data-collapsible="open">
<div class="collapsible-header"><span>üéØ Prompt Transparency Checklist for Demo</span><span class="arrow">‚ñ∂</span></div>
<div class="collapsible-content">
<ul class="dense-list">
<li><strong>Assemble Prompt:</strong> Continue building from the XML template, but dump the fully interpolated string (persona + directive + context + contract) to a signed log before sending.</li>
<li><strong>Expose Live View:</strong> UI inspector should display the literal payload with syntax highlighting and a toggle for surface/insight visibility.</li>
<li><strong>Verify Exact Message:</strong> For this demo turn, capture the final prompt string produced today (October 6, 2025) so reviewers can confirm parity between log and what the agent received.</li>
<li><strong>User Download:</strong> Offer a "Download Prompt" button that exports both the template ID and instantiated prompt for reproducibility.</li>
<li><strong>Moderator Echo:</strong> When routing to multiple philosophers, append a transcript showing which context items were included‚Äîmirroring the cross-response critique loops already defined.</li>
</ul>
</div>
</div>
<div class="collapsible full-width" data-collapsible="closed">
<div class="collapsible-header"><span>üìä User-Facing Inspector Patterns</span><span class="arrow">‚ñ∂</span></div>
<div class="collapsible-content">
<p>Recommended panels for the learner-facing experience:</p>
<table>
<tr><th>Panel</th><th>Contents</th><th>Source</th><th>Notes</th></tr>
<tr><td>Agent Lens</td><td>Chronological list of prompts + responses, including the current turn</td><td><code>ConversationStore</code> API</td><td>Lock scroll to newest; allow toggle between surface and insight.</td></tr>
<tr><td>Prompt Builder</td><td>Rendered XML template with injected variables highlighted</td><td>Moderator service</td><td>Highlight changes since prior turn using diff view.</td></tr>
<tr><td>Context Matrix</td><td>Which prior statements fed each agent this round</td><td><code>metadata.context</code></td><td>Align with critique focus cues from <em>prompt_template_evaluation.html</em>.</td></tr>
<tr><td>Tool Trace</td><td>External lookups, retrieval snippets</td><td>Future integration</td><td>Label experimental to set expectations.</td></tr>
</table>
</div>
</div>
<div class="collapsible full-width" data-collapsible="closed">
<div class="collapsible-header"><span>‚ö° Immediate Next Steps</span><span class="arrow">‚ñ∂</span></div>
<div class="collapsible-content">
<ul class="dense-list">
<li><strong>Implement ContextMirror:</strong> Extend the moderator to emit <code>context_snapshot</code> events (JSON) each time <code>metadata.context</code> is constructed.</li>
<li><strong>UI Hook:</strong> In the React demo, reserve right column for the prompt inspector component‚Äîreuse existing collapsible panels for consistency.</li>
<li><strong>Testing:</strong> Write a harness that simulates multi-round debate and asserts that every agent receives the same history visible in the inspector.</li>
<li><strong>Governance:</strong> Document which roles (learner, facilitator, admin) can toggle insight visibility to respect pedagogical scaffolding.</li>
</ul>
</div>
</div>
</main>
</div>
<script>
document.addEventListener('DOMContentLoaded',function(){
    document.querySelectorAll('[data-collapsible]').forEach(function(section){
        const isOpen = section.getAttribute('data-collapsible') === 'open';
        section.classList.add('collapsible');
        if(isOpen) section.classList.add('open');
    });
    document.querySelectorAll('.collapsible-header').forEach(function(header){
        header.addEventListener('click',function(){
            const collapsible=this.closest('.collapsible');
            collapsible.classList.toggle('open');
        });
    });
    const expandAllBtn=document.getElementById('expand-all');
    const collapseAllBtn=document.getElementById('collapse-all');
    if(expandAllBtn){
        expandAllBtn.addEventListener('click',function(){
            document.querySelectorAll('.collapsible').forEach(function(c){c.classList.add('open');});
        });
    }
    if(collapseAllBtn){
        collapseAllBtn.addEventListener('click',function(){
            document.querySelectorAll('.collapsible').forEach(function(c){c.classList.remove('open');});
        });
    }
});
</script>
</body>
</html>
